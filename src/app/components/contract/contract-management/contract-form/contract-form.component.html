<!-- contract-form.component.html -->
<div class="contract-form">
  <h2>{{ formTitle() }}</h2>

  @if (loading()) {
    <div class="loading-overlay">
      <mat-spinner diameter="40"></mat-spinner>
    </div>
  }

  @if (error()) {
    <mat-error class="error-message">{{ error() }}</mat-error>
  }

  <form [formGroup]="contractForm" (ngSubmit)="onSubmit()">
    <mat-tab-group>
      <!-- Basic Details Tab -->
      <mat-tab label="Basic Details">
        <div class="tab-content">
          <mat-form-field appearance="outline">
            <mat-label>Contract Name</mat-label>
            <input matInput formControlName="name" required>
            <mat-error *ngIf="contractForm.get('name')?.hasError('required')">
              Contract name is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Hotel</mat-label>
            <mat-select formControlName="hotelId" 
                       (selectionChange)="onHotelChange($event.value)" 
                       required>
              @for (hotel of hotels(); track hotel.id) {
                <mat-option [value]="hotel.id">{{ hotel.name }}</mat-option>
              }
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Market</mat-label>
            <mat-select formControlName="marketId" required>
              @for (market of markets(); track market.id) {
                <mat-option [value]="market.id">{{ market.name }}</mat-option>
              }
            </mat-select>
          </mat-form-field>

          <div class="date-range">
            <mat-form-field appearance="outline">
                <mat-label>Valid From</mat-label>
                <input matInput [matDatepicker]="startPicker" formControlName="validFrom" required>
                <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
                <mat-datepicker #startPicker></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Valid To</mat-label>
              <input matInput [matDatepicker]="endPicker" formControlName="validTo" required>
              <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
              <mat-datepicker #endPicker></mat-datepicker>
            </mat-form-field>
          </div>
        </div>
      </mat-tab>

      <!-- Room Types & Meal Plans Tab -->
      <mat-tab label="Room Types & Meal Plans">
        <div class="tab-content">
          <mat-form-field appearance="outline">
            <mat-label>Room Types</mat-label>
            <mat-select formControlName="selectedRooms" multiple required>
              @for (room of roomTypes(); track room.id) {
                <mat-option [value]="room.id">{{ room.name }}</mat-option>
              }
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Meal Plans</mat-label>
            <mat-select formControlName="selectedMealPlans" multiple required>
              @for (plan of mealPlans(); track plan.id) {
                <mat-option [value]="plan.id">{{ plan.name }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>
      </mat-tab>
    </mat-tab-group>

    <!-- Form Actions -->
    <div class="form-actions">
      <button mat-button type="button" (click)="onCancel()">Cancel</button>
      <button mat-raised-button color="primary" 
              type="submit" 
              [disabled]="!contractForm.valid || loading()">
        {{ submitButtonText() }}
      </button>
    </div>
  </form>
</div>
