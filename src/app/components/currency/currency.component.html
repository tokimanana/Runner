<!-- currency.component.html -->
<div class="currency-container">
  <!-- Header -->
  <div class="header">
    <h2>Currency Management</h2>
    <button mat-raised-button color="primary" (click)="openCurrencyEditor()">
      <mat-icon>add</mat-icon>
      Add Currency
    </button>
  </div>

  <!-- Loading State -->
  <div class="loading-spinner" *ngIf="isLoading">
    <mat-spinner diameter="40"></mat-spinner>
  </div>

  <!-- Currency Table -->
  <mat-table [dataSource]="currencySettings()" class="currency-table" *ngIf="!isLoading">
    <!-- Code Column -->
    <ng-container matColumnDef="code">
      <mat-header-cell *matHeaderCellDef>Code</mat-header-cell>
      <mat-cell *matCellDef="let currency">{{currency.code}}</mat-cell>
    </ng-container>

    <!-- Symbol Column -->
    <ng-container matColumnDef="symbol">
      <mat-header-cell *matHeaderCellDef>Symbol</mat-header-cell>
      <mat-cell *matCellDef="let currency">{{currency.symbol}}</mat-cell>
    </ng-container>

    <!-- Name Column -->
    <ng-container matColumnDef="name">
      <mat-header-cell *matHeaderCellDef>Name</mat-header-cell>
      <mat-cell *matCellDef="let currency">{{currency.name}}</mat-cell>
    </ng-container>

    <!-- Status Column -->
    <ng-container matColumnDef="status">
      <mat-header-cell *matHeaderCellDef>Status</mat-header-cell>
      <mat-cell *matCellDef="let currency">
        <mat-slide-toggle
          [checked]="currency.isActive"
          (change)="toggleCurrencyStatus(currency)"
          [disabled]="currency.isActive">
          {{ currency.isActive ? 'Active' : 'Inactive' }}
        </mat-slide-toggle>
      </mat-cell>
    </ng-container>

    <!-- Actions Column -->
    <ng-container matColumnDef="actions">
      <mat-header-cell *matHeaderCellDef>Actions</mat-header-cell>
      <mat-cell *matCellDef="let currency">
        <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Currency actions">
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="openCurrencyEditor(currency)" [disabled]="currency.isActive">
            <mat-icon>edit</mat-icon>
            <span>Edit</span>
          </button>
          <button mat-menu-item (click)="deleteCurrency(currency)" [disabled]="currency.isActive">
            <mat-icon>delete</mat-icon>
            <span>Delete</span>
          </button>
        </mat-menu>
      </mat-cell>
    </ng-container>

    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
    <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
  </mat-table>

  <!-- Empty State -->
  <div class="no-currencies" *ngIf="currencySettings().length === 0 && !isLoading">
    <mat-icon>monetization_on</mat-icon>
    <h3>No Currencies Added</h3>
    <p>Click the "Add Currency" button above to add your first currency.</p>
  </div>

  <!-- Currency Editor Modal -->
  @if (showCurrencyEditor()) {
    <app-modal 
      [title]="selectedCurrency() ? 'Edit Currency' : 'Add Currency'"
      [show]="showCurrencyEditor()"
      (close)="closeCurrencyEditor()">
      <form #currencyForm="ngForm" (ngSubmit)="saveCurrency(currencyForm.value)">
        @for (field of currencyFormFields; track field.key) {
          <mat-form-field appearance="outline">
            <mat-label>{{ field.label }}</mat-label>
            <input 
              matInput
              [name]="field.key"
              [ngModel]="modalInitialValues()[field.key]"
              [required]="field.required ?? false" 
              [placeholder]="field.label">
          </mat-form-field>
        }
        <div class="form-actions">
          <button mat-button type="button" (click)="closeCurrencyEditor()">Cancel</button>
          <button mat-raised-button color="primary" type="submit" [disabled]="!currencyForm.valid">
            {{ selectedCurrency() ? 'Update' : 'Add' }}
          </button>
        </div>
      </form>
    </app-modal>

  }

  <!-- Notification Message -->
  @if (modalMessage()) {
    <div class="notification-message" [class.error]="modalError()">
      {{ modalMessage() }}
    </div>
  }
</div>
